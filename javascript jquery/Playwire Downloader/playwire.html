<!DOCTYPE html>
<html>
<head>
	<title>Playwire</title>
</head>
<script type="text/javascript" src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<body>

<input type="" name=""><button>+</button>
<p></p>

<script type="text/javascript">

// https://cdn.video.playwire.com/21772/videos/5144726/video-mobile.mp4
// https://cdn.video.playwire.com/21772/videos/5144726/video-sd.mp4
// http://config.playwire.com/21772/videos/v2/5144726/zeus.json

// config.playwire.com/21772/videos/v2/5144726/zeus.json

var main = function(){

	// variables
	var $input = $('input'), 
		$button = $('button'), 
		$replaceP = $('p');

	var inputVal, 
		playwireLink;


	// on click event
	$button.on('click', function(){
		checkValidInput();
	});

	// on enter keypress
	$input.on('keypress', function(event){
		if (event.keyCode === 13) {
			checkValidInput();
		}
	});



	// check for valid input
	var checkValidInput = function(){
		
		inputVal = $input.val();
		var inputIndex = inputVal.indexOf('config.playwire.com');	

		if (inputIndex >= 0) {
			// add http if needed
			addHttpToLink(inputIndex, inputVal);
			// playwireLink = inputVal;
			// changeUrl(inputIndex);
		} else if (inputVal === '') {
			$replaceP.html('empty input');
		} else {
			$replaceP.html('not a playwire link');
		}

	};


	// change the url into downloadable version
	var changeUrl = function(inputIndex){

		// grab first value
		var firstVal = playwireLink.substring(inputIndex + 20, inputIndex + 25);

		// grab the second value
		var secondVal = playwireLink.substring(inputIndex + 36, inputIndex + 43); 
		// NOTE: is the second value always 7 character? maybe use indexOf to find the zeus.json and videos/v2/ and work backwards from there?

		// compile values into URL
		var compiledUrl = 'https://cdn.video.playwire.com/' + firstVal + '/videos/' + secondVal + '/video-sd.mp4';
		
		$replaceP.html('<a href="' + compiledUrl + '">Download</a>');

	};


	// parse the json
	var parseJson = function(playwireLink){
		$.getJSON(playwireLink, function(result){
			// console.log(result);
			console.log(result.settings.title);
			var playwireTitle = result.settings.title;
			console.log(result.publisherId);
			var playwirePublisher = result.publisherId
			console.log(result.content.videoId);
			var playwireVideo = result.content.videoId
		});
	};


	// add http to playwireLink2
	var addHttpToLink = function(inputIndex, inputVal){
		var playwireLink = 'http://' + inputVal.substring(inputIndex);
		parseJson(playwireLink);

	};

};

$(document).ready(main);

</script>

</body>
</html>